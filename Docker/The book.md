---
sticker: emoji//1f4d6
---
（1）容器生态系统包含哪些不同层次的技术？
（2）不同技术之间是什么关系？
（3）哪些是核心技术？哪些是辅助技术？


## 容器生态系统
1. 核心技术：能够***让Container在host上运行起来的技术***
	1. 容器规范：为了保证容器生态的健康发展，保证不同容器之间能够兼容，包含Docker、CoreOS、Google在内的若干公司共同成立了一个叫Open Container Initiative(OCI)的组织，其目的是制定开放的容器规范。
	2. 容器runtime：runtime是容器真正运行的地方。runtime需要跟***操作系统kernel***紧密协作，为容器提供运行环境。
	3. 容器管理工具：除了runtime，用户需要工具来管理容器。容器管理工具对内与runtime交互，对外为用户提供interface，比如CLI。
	4. 容器定义工具：允许用户定义容器的内容和属性，这样容器就能够被保存、共享和重建。
	5. Registry：容器是通过image创建的，需要有一个仓库来统一存放image，这个仓库就叫做Registry。
	6. 容器OS：由于有容器runtime，几乎所有的Linux、MAC OS和Windows都可以运行容器，但这并没有妨碍容器OS的问世。

2. 平台技术：能够***让Container作为集群在分布式环境中运行***
	1. 容器编排引擎：基于容器的应用一般会采用***微服务架构***。为了保证应用的高可用，每个组件都可能会运行多个相同容器。这些容器会组成集群，集群中的容器会根据业务需要被动态地创建、迁移和销毁。
	2. 容器管理平台：容器管理平台是架构在容器编排引擎之上的一个更为通用的平台。通常容器管理平台能够支持多种编排引擎，抽象了编排引擎的底层实现细节，为用户提供更方便的功能，比如application catalog和一键应用部署等。
	3. 基于容器的PaaS：基于容器的PaaS为微服务应用开发人员和公司提供了开发、部署和管理应用的平台，使用户不必关心底层基础设施而专注于应用的开发。
	
3. 支持技术：支持基于Container的基础设施，包括容器网络、服务发现、监控、数据管理、日志管理和安全性
	1. 容器网络：容器的出现使网络拓扑变得更加动态和复杂。用户需要专门的解决方案来管理容器与容器、容器与其他实体之间的连通性和隔离性。
	2. 服务发现：动态变化是微服务应用的一大特点。负载增加时，集群会自动创建新的容器；负载减小，多余的容器会被销毁。容器也会根据host的资源使用情况在不同host中迁移，容器的IP和端口也会随之发生变化。在这种动态的环境下，必须要有一种机制让client能够知道如何访问容器提供的服务。这就是服务发现技术要完成的工作。
	3. 监控：监控对于基础架构非常重要，而容器的动态特征对监控提出更多挑战。针对容器环境，已经涌现出很多监控工具和方案。
	4. 数据管理：容器经常会在不同的host之间迁移，如何保证持久化数据也能够动态迁移，是Rex-Ray这类数据管理工具提供的能力。
	5. 日志管理：日志为问题排查和事件管理提供了重要依据。日志工具有两类。
	6. 安全性：对于年轻的容器，安全性一直是争论的焦点。OpenSCAP是一种容器安全工具。

容器技术是当前云计算和微服务领域的重要基础，可以实现应用程序的快速部署、扩展和管理。
容器生态系统包括多个技术和工具，如Docker、Kubernetes等。
- Docker是容器技术的代表，提供了容器镜像、容器运行时等核心功能。
- Kubernetes是容器编排和管理工具，可以实现容器集群的自动化部署、扩展和管理。

## 容器技术

### 容器

#### 什么是容器？
1. 实现容器的底层技术
		1. **Namespace:** 对全局资源系统（进程、网络、文件资源）进行分装隔离，使处于不同namespace的进程拥有独立的全局系统资源，改变一个namespace中的系统资源只会影响当前namespace里的进程，对其他namespace中的进程没有影响。
			1. **为什么隔离？** 如果在服务器上启动了多个服务，服务之间互相影响，每个服务都能看到其他服务的进程，也可以访问host machine上的任意文件，造成安全隐患。
			2. **隔离了什么？** 
				1. 进程：进程表示一个正在执行的程序，也是在现代分时系统中的一个任务单元。和宿主机分开。
				2. 网络接口：和宿主机隔离，但仍然访问外界网络，以及和其他容器的通信。
				3. 文件系统：容器启动需要一个根文件系统（rootfs），容器需使用该文件系统创建一个新的进程，所有二进制的执行都必须在这个根文件系统中。将容器需要的目录挂载到了容器中，同时也禁止当前的容器进程访问宿主机器上的其他目录，保证了不同文件系统的隔离。
			3. **如何隔离？** Linux 的命名空间机制提供了以下七种不同的命名空间：`CLONE_NEWCGROUP`、`CLONE_NEWIPC`、`CLONE_NEWNET`、`CLONE_NEWNS`、`CLONE_NEWPID`、`CLONE_NEWUSER` 和 `CLONE_NEWUTS`。
		2. **Control group:** 控制一组进程的资源使用，隔离物理资源（例如 CPU、内存、磁盘 I/O 和网络带宽），避免多个容器相互影响并且抢占宿主机的资源。每一个 CGroup 都是一组被相同的标准和参数限制的进程，不同的 CGroup 之间有层级关系，可以从父类继承一些用于限制资源使用的标准和参数。
		3. **Union filesystem:** 将多个文件系统合并为一个文件系统，以便在Docker容器中共享数据。Container format是Docker容器的核心，包含了容器的所有信息，包括应用程序、库、依赖项、环境变量、网络配置等。
	
	辅助技术包括Docker Hub，Docker Compose，Docker Swarm等。
		
1. 为什么需要容器？
2. 容器如何工作？


### Docker

#### 镜像
#### 容器


The isolated nature of containers necessitates explicit mechanisms for inter-container communication (networking) and persistent data storage (volumes).
#### 网络
Docker网络从覆盖范围可分为单个host上的容器网络和跨多个host的网络
Docker安装时会自动在host上创建三个网络: none, host, bridge
1. none:

可用docker network create创建自定义网络，自定义网络需指定网络驱动和容器间连接方式。
容器之间可以通过自定义网络进行通信
容器可以通过端口映射或路由规则与外界交互
端口映射可以将容器内部端口映射到host上的端口
路由规则可以将容器内部流量转发到其他容器或host

#### 存储
Docker为容器提供了两种存储资源：数据层和Data Volume。数据层包括镜像层和容器层，由storage driver管理。
Data Volume有两种类型：bind mount和docker managed volume
- bind mount可实现容器与host之间、容器与容器之间共享数据。
- volume container是一种具有更好移植性的容器间数据共享方案，特别是data-packed volume container。



## 容器进阶
多主机管理
容器网络
容器监控
日志管理
数据管理
